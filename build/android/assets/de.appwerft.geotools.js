"toRadians"in Number.prototype||(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),"toRadians"in Number.prototype||(Number.prototype.toRadians=function(){return this*Math.PI/180});var geonamesuser=Ti.App.Properties.hasProperty("geonamesuser")?Ti.App.Properties.getString("geonamesuser"):"demo",googleapikey=Ti.App.Properties.hasProperty("googleapikey")?Ti.App.Properties.getString("googleapikey"):"demo",Promise=require("org.favo.promise"),TI_XML_ELEMENT_NODE=Ti.XML.Node.ELEMENT_NODE,parseAndRenderKML=function(e,t){console.log(">>>>>>>>>>>>");for(var n,r,s=(new Date).getTime(),i=e.getElementsByTagName("Placemark"),a=i.length,o={};a;){n=i.item(--a).getChildNodes();for(var l,d,p=0,E=n.length;E>p;p++)l=n.item(p),d=l.getNodeName(),"#text"!=d&&(o[d]=l.getTextContent());if(r=o.Point){var c=r.replace(/\s/g,"").split(",");o.latitude=parseFloat(c[1],10),o.longitude=parseFloat(c[0],10),delete o.Point,t.points.push(o)}else void 0!==o.LineString?t.lines.push(o):void 0!==o.Polygon&&t.polygones.push(o)}console.log("Info: KML parsingtime: "+((new Date).getTime()-s))},Module={getPositionByIP:function(e){var t=e?e:Ti.Platform.getAddress(),n=Promise.defer(),r=Ti.Network.createHTTPClient({onload:function(){console.log(this.responseText),n.resolve(JSON.parse(this.responseText))},onerror:function(e){console.log(e),n.reject(e)}});return r.open("GET","http://freegeoip.net/json/"+t),console.log("http://freegeoip.net/json/"+t),r.send(),n},getElevation:function(){var e=arguments[0]||{},t=Array.isArray(e)?e[0]:e.lat||e.latitude,n=Array.isArray(e)?e[1]:e.lng||e.lon||e.longitude,r=Promise.defer(),s=Ti.Network.createHTTPClient({onload:function(){r.resolve(JSON.parse(this.responseText))},onerror:function(e){r.reject(e)}});return s.open("POST","http://api.geonames.org/astergdemJSON?lat="+t+"&lng="+n+"&username="+geonamesuser),s.send(),r},getRegionByCountry:function(e){var t=Promise.defer(),n=e||"Deutschland",r=Ti.Network.createHTTPClient({onload:function(){try{var e=JSON.parse(this.responseText);if("OK"==e.status){var n=e.results[0].geometry,r={latitude:n.location.lat,longitude:n.location.lng,latitudeDelta:Math.abs(n.viewport.northeast.lat-n.viewport.southwest.lat),longitudeDelta:Math.abs(n.viewport.northeast.lng-n.viewport.southwest.lng)};t.resolve(r)}}catch(s){t.reject(s)}},onerror:function(){t.reject(_e)}});return r.open("GET","http://maps.googleapis.com/maps/api/geocode/json?address="+n+"&sensor=false"),r.send(),t},getRoute:function(){var e=Promise.defer(),t=function(e){for(var t=e.length,n=0,r=[],s=0,i=0;t>n;){var a,o=0,l=0;do a=e.charCodeAt(n++)-63,l|=(31&a)<<o,o+=5;while(a>=32);var d=1&l?~(l>>1):l>>1;s+=d,o=0,l=0;do a=e.charCodeAt(n++)-63,l|=(31&a)<<o,o+=5;while(a>=32);var p=1&l?~(l>>1):l>>1;i+=p,r.push([1e-5*s,1e-5*i])}for(var E=[],c=0;c<r.length;c++)E.push({latitude:r[c][0],longitude:r[c][1]});return E},n=arguments[0]||{},r=arguments[1]||{},s=arguments[2]||"WALKING",i=Array.isArray(n)?n[0]:n.lat||n.latitude,a=Array.isArray(n)?n[1]:n.lng||n.lon||n.longitude,o=Array.isArray(r)?r[0]:r.lat||r.latitude,l=Array.isArray(r)?r[1]:r.lng||r.lon||r.longitude,d=Ti.Network.createHTTPClient({onload:function(){var n=JSON.parse(this.responseText).routes[0];n?e.resolve({steps:n.legs[0].steps,meta:n.legs[0].distance.text+"\n"+n.legs[0].duration.text,end_address:n.legs[0].end_address,start_address:n.legs[0].start_address,region:{latitude:(n.bounds.northeast.lat+n.bounds.southwest.lat)/2,longitude:(n.bounds.northeast.lng+n.bounds.southwest.lng)/2,latitudeDelta:1.2*Math.abs(n.bounds.northeast.lat-n.bounds.southwest.lat),longitudeDelta:1.2*Math.abs(n.bounds.northeast.lng-n.bounds.southwest.lng)},route:t(n.overview_polyline.points)}):e.reject()}}),p="https://maps.googleapis.com/maps/api/directions/json?language="+Ti.Locale.getCurrentLanguage()+"&sensor=false&mode="+s+"&origin="+i+","+a+"&destination="+o+","+l;return d.open("GET",p),d.send(),e},loadKML:function(){var e=arguments[0],t=Promise.defer(),n=Ti.Network.createHTTPClient({onload:function(){var e=((new Date).getTime(),{points:[],lines:[],polygons:[],statistics:null});parseAndRenderKML(this.responseXML.documentElement,e),t.resolve(e)},onerror:function(e){t.reject(e)}});return n.open("GET",e),n.send(),t},GaussKrueger2Geo:function(){var e=arguments[0]||{},t=e.rw,n=e.hw;return""==t||""==n?(lp="",void(bp="")):(t=parseFloat(t),n=parseFloat(n),a=6377397.155,f=.00334277321,pi=Math.PI,c=a/(1-f),ex2=(2*f-f*f)/((1-f)*(1-f)),ex4=ex2*ex2,ex6=ex4*ex2,ex8=ex4*ex4,e0=c*(pi/180)*(1-3*ex2/4+45*ex4/64-175*ex6/256+11025*ex8/16384),f2=180/pi*(3*ex2/8-3*ex4/16+213*ex6/2048-255*ex8/4096),f4=180/pi*(21*ex4/256-21*ex6/256+533*ex8/8192),f6=180/pi*(151*ex6/6144-453*ex8/12288),sigma=n/e0,sigmr=sigma*pi/180,bf=sigma+f2*Math.sin(2*sigmr)+f4*Math.sin(4*sigmr)+f6*Math.sin(6*sigmr),br=bf*pi/180,tan1=Math.tan(br),tan2=tan1*tan1,tan4=tan2*tan2,cos1=Math.cos(br),cos2=cos1*cos1,etasq=ex2*cos2,nd=c/Math.sqrt(1+etasq),nd2=nd*nd,nd4=nd2*nd2,nd6=nd4*nd2,nd3=nd2*nd,nd5=nd4*nd,kz=parseInt(t/1e6),lh=3*kz,dy=t-(1e6*kz+5e5),dy2=dy*dy,dy4=dy2*dy2,dy3=dy2*dy,dy5=dy4*dy,dy6=dy3*dy3,b2=-tan1*(1+etasq)/(2*nd2),b4=tan1*(5+3*tan2+6*etasq*(1-tan2))/(24*nd4),b6=-tan1*(61+90*tan2+45*tan4)/(720*nd6),l1=1/(nd*cos1),l3=-(1+2*tan2+etasq)/(6*nd3*cos1),l5=(5+28*tan2+24*tan4)/(120*nd5*cos1),bp=bf+180/pi*(b2*dy2+b4*dy4+b6*dy6),lp=lh+180/pi*(l1*dy+l3*dy3+l5*dy5),(5>lp||lp>16||46>bp||bp>56)&&(lp="",bp=""),{latitude:bp,longitude:lp})},getDistBearing:function(e,t,n,r){const s=(Math.PI,6371e3);var e=e.toRadians(),n=n.toRadians(),i=(n-e).toRadians(),a=(r-t).toRadians(),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e)*Math.cos(n)*Math.sin(a/2)*Math.sin(a/2),l=Math.sin(r-t)*Math.cos(n),d=Math.cos(e)*Math.sin(n)-Math.sin(e)*Math.cos(n)*Math.cos(r-t);return{bearing:Math.atan2(l,d).toDegrees(),distance:2*s*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}},UTM2Geo:function(e,t,n){if(""==e||""==t||""==n)return e="",t="",void(n="");if(band=e.substr(2,1),e=parseFloat(e),t=parseFloat(t),n=parseFloat(n),a=6378137,f=.00335281068,pi=Math.PI,c=a/(1-f),ex2=(2*f-f*f)/((1-f)*(1-f)),ex4=ex2*ex2,ex6=ex4*ex2,ex8=ex4*ex4,e0=c*(pi/180)*(1-3*ex2/4+45*ex4/64-175*ex6/256+11025*ex8/16384),f2=180/pi*(3*ex2/8-3*ex4/16+213*ex6/2048-255*ex8/4096),f4=180/pi*(21*ex4/256-21*ex6/256+533*ex8/8192),f6=180/pi*(151*ex6/6144-453*ex8/12288),band>="N"||""==band)var r=n;else var r=n-1e7;sigma=r/.9996/e0,sigmr=sigma*pi/180,bf=sigma+f2*Math.sin(2*sigmr)+f4*Math.sin(4*sigmr)+f6*Math.sin(6*sigmr),br=bf*pi/180,tan1=Math.tan(br),tan2=tan1*tan1,tan4=tan2*tan2,cos1=Math.cos(br),cos2=cos1*cos1;var s=ex2*cos2;return nd=c/Math.sqrt(1+s),nd2=nd*nd,nd4=nd2*nd2,nd6=nd4*nd2,nd3=nd2*nd,nd5=nd4*nd,lh=6*(e-30)-3,dy=(t-5e5)/.9996,dy2=dy*dy,dy4=dy2*dy2,dy3=dy2*dy,dy5=dy3*dy2,dy6=dy3*dy3,b2=-tan1*(1+s)/(2*nd2),b4=tan1*(5+3*tan2+6*s*(1-tan2))/(24*nd4),b6=-tan1*(61+90*tan2+45*tan4)/(720*nd6),l1=1/(nd*cos1),l3=-(1+2*tan2+s)/(6*nd3*cos1),l5=(5+28*tan2+24*tan4)/(120*nd5*cos1),bw=bf+180/pi*(b2*dy2+b4*dy4+b6*dy6),lw=lh+180/pi*(l1*dy+l3*dy3+l5*dy5),{latitude:bw,longitude:lw}}};module.exports=Module;