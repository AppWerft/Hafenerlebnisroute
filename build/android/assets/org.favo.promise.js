!function(e){e([],function(){"use strict";var e=Object.freeze||function(){},t=function(){};t.prototype.resolve,t.prototype.reject,t.prototype.then;var i=function(e){this.state_=i.State.UNRESOLVED,this.chain_=[],this.scope_=e||null};i.prototype.state_,i.prototype.chain_,i.prototype.scope_,i.prototype.result_,i.prototype.then=function(e,t,n){return this.chain_.push([e||null,t||null,n||null]),this.state_!==i.State.UNRESOLVED&&this.fire_(),this},i.prototype.resolve=function(e){this.state_=i.State.RESOLVED,this.fire_(e)},i.prototype.reject=function(e){this.state_=i.State.REJECTED,this.fire_(e)},i.prototype.isResolved=function(){return this.state_===i.State.RESOLVED},i.prototype.isRejected=function(){return this.state_===i.State.REJECTED},i.prototype.next=function(e,t,n){var a=n||10,l=new i(this);return l.then(e,t),this.then(function(e){setTimeout(function(){l.resolve(e)},a)},function(e){setTimeout(function(){l.reject(e)},a)}),l},i.prototype.fire_=function(e){for(var t=this.result_="undefined"!=typeof e?e:this.result_;this.chain_.length;){var n=this.chain_.shift(),a=this.state_===i.State.REJECTED?n[1]:n[0];if(a)try{t=this.result_=a.call(this.scope_,t)}catch(l){this.state_=i.State.REJECTED,t=this.result_=l}}},i.State={UNRESOLVED:"unresolved",RESOLVED:"resolved",REJECTED:"rejected"},e(i.State);var n=function(e){return e&&"function"==typeof e.then},a=function(){for(var e=new i,t=[].slice.call(arguments,0),a=[],l=function(i){a.push(i),t.length===a.length&&e.resolve(a)},d=function(t){e.reject(t)},r=0,s=t.length;s>r;r++){var u=t[r];n(u)?u.then(l,d).resolve():"function"==typeof u?(new i).then(u).then(l,d).resolve():(new i).then(function(){return u}).then(l,d).resolve()}return e};return{defer:function(e){return new i(e)},isPromise:n,when:a}})}("undefined"!=typeof define?define:"undefined"!=typeof module?function(e,t){module.exports=t()}:function(e,t){this.Promise=t()});