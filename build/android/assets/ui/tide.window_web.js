const LATTENHEIGHT=366;var Tide=new(require("controls/bsh.proxy")),Moment=require("vendor/moment"),swipeRefreshModule=require("com.rkam.swiperefreshlayout");module.exports=function(){function e(){Tide.getPrediction(t.id,{onOk:function(e){if(i.swipeRefreshContainer.setRefreshing(!1),null==e)return void alert("Für diesen Messpunkt liegen für das Jahr 2015 leider keine Angaben vor. ");if(n.addScala({current:Math.ceil(e.current.level)+1}),console.log(e.current),e.current.level){console.log("tides.current.level="+e.current.level);{"+"==e.current.direction?-10:10}n.moveTo(e.current.direction,e.current.level)}else n.hide();var t=[],a=[];null==e&&(i.swipeRefreshContainer.setRefreshing(!1),alert("Keine Tidedaten vorhanden – offline?"));for(var l=0;l<e.predictions.length;l++){var r=require("vendor/moonphases").get(Moment().add(l,"d"));a[l]=Ti.UI.createView({height:18,backgroundColor:"#092B55"}),a[l].add(Ti.UI.createLabel({text:e.predictions[l].label,textAlign:"left",left:40,font:{fontSize:14,fontFamily:"Aller"},color:"white"})),a[l].add(Ti.UI.createImageView({image:"/assets/moon/moon"+Math.round(r.age)+".png",left:0,height:Ti.UI.FILL,width:18})),t[l]=Ti.UI.createTableViewSection({headerView:a[l]});e.predictions[l].tides.forEach(function(e){e.in_past||t[l].add(require("ui/tide.row")(e))}),i.scheduler.setData(t)}},onerror:function(){i.swipeRefreshContainer.setRefreshing(!1)}})}var t={label:"Hamburg, St. Pauli",gps:"53.545555,9.97",id:"DE__508P",skn:1.9},i=Ti.UI.createWindow(),n=require("ui/wasserstand").createView();i.add(Ti.UI.createImageView({image:"/assets/bg.png",top:0,width:Ti.UI.FILL,height:"auto"}));return i.scheduler=Ti.UI.createTableView({top:0,bottom:240,height:Ti.UI.FILL}),i.swipeRefreshContainer=swipeRefreshModule.createSwipeRefresh({view:i.scheduler,top:0,bottom:200,height:Ti.UI.FILL,width:Ti.UI.FILL}),i.swipeRefreshContainer.addEventListener("refreshing",e),i.scheduler.addEventListener("scroll",function(){}),i.tideview=Ti.UI.createWebView({url:"/html/index.html",bottom:0,opacity:0,backgroundColor:"#092B55",disableBounce:!0,scalesPageToFit:!0,height:200}),i.tideview.addEventListener("load",function(){var e={all:Tide.getChartData(t.id).join(",")};e.narrow=e.all.slice(0,800),e.active="narrow";var n=Ti.Platform.displayCaps.platformWidth/Ti.Platform.displayCaps.logicalDensityFactor,a=200,l="setChart({w:"+n+",h:"+a+",datas:["+e[e.active]+"]});";i.tideview.animate({opacity:1}),i.tideview.evalJS(l),i.tideview.addEventListener("click",function(){e.active="all"==e.active?"narrow":"all";var t="setChart({w:"+n+",h:"+a+",datas:["+e[e.active]+"]});";i.tideview.evalJS(t)})}),i.add(i.swipeRefreshContainer),i.add(i.tideview),Ti.Android&&i.addEventListener("focus",function(){}),Ti.Android&&i.addEventListener("blur",function(){}),Ti.Android&&i.addEventListener("open",function(){e(),Ti.UI.createNotification({message:"Gezeitendaten für St. Pauli vom Bundesamt für Seeschiffahrt und Hydrographie"}).show()}),i.add(n),i};